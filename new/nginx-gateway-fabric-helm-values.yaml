# NGINX Gateway Fabric Helm Values
# For use with: helm install ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric -f values.yaml

# Number of replicas for high availability
replicaCount: 2

# # NGINX Gateway Fabric image configuration
# nginxGateway:
#   # Enable experimental Gateway API features
#   gwAPIExperimentalFeatures:
#     enable: true

#   # Image configuration
#   image:
#     repository: oci://ghcr.io/nginx/charts/nginx-gateway-fabric
#     pullPolicy: IfNotPresent
#     # tag: "1.1.0"  # Uncomment to pin specific version

# Service configuration for AWS NLB
service:
  type: LoadBalancer
  annotations:
    # Use Network Load Balancer
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    # Internet-facing load balancer
    service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
    # Use IP target type for better integration with pods
    service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "ip"
    # Enable cross-zone load balancing for better availability
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"

# Resource requests and limits
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 1000m
    memory: 512Mi

# Pod anti-affinity for spreading across availability zones
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - nginx-gateway-fabric
          topologyKey: topology.kubernetes.io/zone

# Pod Disruption Budget (ensure at least 2 pods available during updates)
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# Metrics configuration for Prometheus
metrics:
  enabled: true
  port: 9113
